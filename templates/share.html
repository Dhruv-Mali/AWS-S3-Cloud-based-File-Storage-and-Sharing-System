{% extends "base.html" %}

{% block title %}Share File - AWS S3 Storage{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="bi bi-share"></i> Share File</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <h5><i class="bi bi-check-circle"></i> Share Link Generated!</h5>
                    <p class="mb-0">Your file <strong>{{ filename }}</strong> is ready to share.</p>
                </div>

                <div class="mb-4">
                    <label for="shareUrl" class="form-label">Shareable Link (Valid for 7 days)</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="shareUrl" value="{{ share_url }}" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                    </div>
                    <div class="form-text">
                        This link will expire in 7 days for security purposes.
                    </div>
                </div>

                <div class="alert alert-info">
                    <h6><i class="bi bi-info-circle"></i> Sharing Information</h6>
                    <ul class="mb-0">
                        <li>Link is valid for 7 days from generation</li>
                        <li>No authentication required to access the file</li>
                        <li>Link will automatically expire for security</li>
                        <li>Generate a new link if this one expires</li>
                    </ul>
                </div>

                <div class="d-grid gap-2">
                    <a href="{{ share_url }}" class="btn btn-primary" target="_blank">
                        <i class="bi bi-box-arrow-up-right"></i> Open File
                    </a>
                    <a href="{{ url_for('list_files') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Files
                    </a>
                </div>
            </div>
        </div>

        <!-- QR Code Card (Optional Enhancement) -->
        <div class="card mt-4">
            <div class="card-body text-center">
                <h5><i class="bi bi-qr-code"></i> Quick Share</h5>
                <p class="text-muted">You can also share this file by copying the link above or opening it directly.</p>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="shareViaEmail()">
                        <i class="bi bi-envelope"></i> Email
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="shareViaWhatsApp()">
                        <i class="bi bi-whatsapp"></i> WhatsApp
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="shareViaTelegram()">
                        <i class="bi bi-telegram"></i> Telegram
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function copyToClipboard() {
        const shareUrl = document.getElementById('shareUrl');
        shareUrl.select();
        shareUrl.setSelectionRange(0, 99999);
        
        try {
            document.execCommand('copy');
            
            // Show success feedback
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="bi bi-check"></i> Copied!';
            button.classList.remove('btn-outline-secondary');
            button.classList.add('btn-success');
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
            }, 2000);
        } catch (err) {
            alert('Failed to copy link. Please copy manually.');
        }
    }

    function shareViaEmail() {
        const subject = encodeURIComponent('Shared file: {{ filename }}');
        const body = encodeURIComponent('Hi,\n\nI\'m sharing a file with you: {{ filename }}\n\nDownload link: {{ share_url }}\n\nNote: This link will expire in 7 days.\n\nBest regards');
        window.open(`mailto:?subject=${subject}&body=${body}`);
    }

    function shareViaWhatsApp() {
        const text = encodeURIComponent('Check out this file: {{ filename }}\n{{ share_url }}\n\n*Note: Link expires in 7 days*');
        window.open(`https://wa.me/?text=${text}`, '_blank');
    }

    function shareViaTelegram() {
        const text = encodeURIComponent('Shared file: {{ filename }}\n{{ share_url }}\n\nNote: Link expires in 7 days');
        window.open(`https://t.me/share/url?url={{ share_url }}&text=${text}`, '_blank');
    }
</script>
{% endblock %}